<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Day25-27</title>
</head>
<body>
  <select id="year-select">
    <option value="2000">2000</option>
    <option value="2001">2001</option>
    <option value="2002">2002</option>
    <option value="2003">2003</option>
    <option value="2004">2004</option>
    <option value="2005">2005</option>
    <option value="2006">2006</option>
    <option value="2007">2007</option>
    <option value="2008">2008</option>
    <option value="2009">2009</option>
    <option value="2010">2010</option>
    <option value="2011">2011</option>
    <option value="2012">2012</option>
    <option value="2013">2013</option>
    <option value="2014">2014</option>
    <option value="2015">2015</option>
    <option value="2016">2016</option>
    <option value="2017">2017</option>
    <option value="2018">2018</option>
    <option value="2019">2019</option>
    <option value="2020">2020</option>
    <option value="2021">2021</option>
    <option value="2022">2022</option>
    <option value="2023">2023</option>
    <option value="2024">2024</option>
    <option value="2025">2025</option>
    <option value="2026">2026</option>
    <option value="2027">2027</option>
    <option value="2028">2028</option>
    <option value="2029">2029</option>
    <option value="2030">2030</option>
    <option value="2031">2031</option>
    <option value="2032">2032</option>
  </select>

  <select id="month-select">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
  </select>

  <select id="day-select">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
  </select>

  <select id="hour-select">
    <option value="0">00</option>
    <option value="1">01</option>
    <option value="2">02</option>
    <option value="3">03</option>
    <option value="4">04</option>
    <option value="5">05</option>
    <option value="6">06</option>
    <option value="7">07</option>
    <option value="8">08</option>
    <option value="9">09</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
  </select>

  <select id="minute-select">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">50</option>
    <option value="51">51</option>
    <option value="52">52</option>
    <option value="53">53</option>
    <option value="54">54</option>
    <option value="55">55</option>
    <option value="56">56</option>
    <option value="57">57</option>
    <option value="58">58</option>
    <option value="59">59</option>
  </select>

  <select id="second-select">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">50</option>
    <option value="51">51</option>
    <option value="52">52</option>
    <option value="53">53</option>
    <option value="54">54</option>
    <option value="55">55</option>
    <option value="56">56</option>
    <option value="57">57</option>
    <option value="58">58</option>
    <option value="59">59</option>
  </select>

  <p id="result-wrapper"></p>

  <script type="text/javascript">
      function isLeapYear(n) {
          return ((n % 4 === 0 && n % 100 !== 0) || n % 400 === 0);
      }

      function hideOption(p) {
          var span;

          parent = p.parentNode;
          span = document.createElement("span");
          span.style.display = "none";
          span.innerHTML = p.outerHTML;
          parent.replaceChild(span, p);
      }

      function adjustDays(year, month) {
          console.log(year + month);
          switch (month) {
              case 1: case 3: case 5: case 7:
              case 8: case 10: case 12:
                  break;
              case 4: case 6: case 9: case 11:
                  hideOption(document.querySelector("#day-select > option:last-child"));
                  break;
              case 2:
                  hideOption(document.querySelector("#day-select > option:last-child"));
                  hideOption(document.querySelector("#day-select > option:last-child"));
                  if (!isLeapYear(year)) {
                      hideOption(document.querySelector("#day-select > option:last-child"));
                  }
                  break;
          }
      }

      function getSelectedOption(selectId) {
          var options,
              i;

          options = document.querySelectorAll("#" + selectId + " option");
          for (i = 0; i < options.length; i++) {
              if (options[i].selected) {
                  return options[i];
              }
          }
      }

      function checkTime(n) {
          return n < 10 ? "0"+n : ""+n;
      }

      function selectedTime() {
          var year,
              month,
              day,
              hour,
              minute,
              second,
              week,
              strValue,
              dateValue,
              resObj;

          resObj = {};
          week = ["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];
          year = getSelectedOption("year-select").value;
          month = getSelectedOption("month-select").value;
          day = getSelectedOption("day-select").value;
          hour = getSelectedOption("hour-select").value;
          minute = getSelectedOption("minute-select").value;
          second = getSelectedOption("second-select").value;
          dateValue = new Date(year, month-1, day, hour, second, second);
          resObj.dateValue = dateValue;
          strValue = "";
          strValue += year + "年" + month + "月" + day + "日";
          strValue += week[dateValue.getDay()];
          strValue += " " + checkTime(hour) + ":" + checkTime(minute) + ":" + checkTime(second) + " ";
          resObj.strValue = strValue;
          return resObj;
      }

      function timeDiff() {
          var year,
              month,
              day,
              hour,
              minute,
              second,
              now,
              selected,
              diff,
              strValue;

          now = new Date();
          selected = selectedTime().dateValue;
          diff = new Date(Math.abs(now-selected));
          year = diff.getUTCFullYear() - 1970;
          month = diff.getUTCMonth();
          day = diff.getUTCDate() - 1;
          hour = diff.getUTCHours();
          minute = diff.getUTCMinutes();
          second = diff.getUTCSeconds();
          strValue = "";
          strValue += (now - selected > 0) ? "已经过去 " : "还有 ";
          strValue += year + "年" + month + "月" + day + "日";
          strValue += hour + "小时" + minute + "分" + second + "秒";
          return strValue;
      }

      function disResult() {
          var p;

          p = document.querySelector("#result-wrapper");
          p.innerHTML = "现在距离" + selectedTime().strValue + timeDiff();
      }

      var selects,
          i;

      selects = document.querySelectorAll("select");
      for (i = 0; i < selects.length; i++) {
          selects[i].onclick = function(event) {
              adjustDays(getSelectedOption("year-select").value, +getSelectedOption("month-select").value);
              disResult();
          }
      }
  </script>

</body>
</html>
